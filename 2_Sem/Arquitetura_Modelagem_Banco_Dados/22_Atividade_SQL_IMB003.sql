CREATE TABLE CAP_CAPTURA (
  CAP_ID NUMBER(5),
  CONSTRAINT CAP_PK PRIMARY KEY (CAP_ID),
  CAP_DT_HR DATE,
  CRI_NOME VARCHAR2(30),
  CONSTRAINT CAP_CRI_FK FOREIGN KEY (CRI_NOME) REFERENCES CRI_CRIATURA (CRI_NOME),
  LOC_LATITUDE NUMBER(10,6),
  LOC_LONGITUDE NUMBER(10,6),
  CONSTRAINT CAP_LOC_FK FOREIGN KEY (LOC_LATITUDE, LOC_LONGITUDE) REFERENCES LOC_LOCAL (LOC_LATITUDE, LOC_LONGITUDE)  
);

CREATE SEQUENCE CAP_SEQ;

--INSERT 3 TIPOS, SENDO 1 DELES 'FOGO'
INSERT INTO TIP_TIPO (TIP_NOME) VALUES ('FOGO');
INSERT INTO TIP_TIPO (TIP_NOME) VALUES ('AGUA');
INSERT INTO TIP_TIPO (TIP_NOME) VALUES ('ELETRICO');

--INSERT 6 HABILIDADES, COM, NO MÍNIMO, 2 DO TIPO 'FOGO'
INSERT INTO HAB_HABILIDADE (HAB_NOME, HAB_PODER_ATAQUE, TIP_NOME) VALUES ('QUEIMAR COM FOSFORO', 8, 'FOGO');
INSERT INTO HAB_HABILIDADE (HAB_NOME, HAB_PODER_ATAQUE, TIP_NOME) VALUES ('METEORO DA PAIXAO', 90, 'FOGO');
INSERT INTO HAB_HABILIDADE (HAB_NOME, HAB_PODER_ATAQUE, TIP_NOME) VALUES ('BOLINHA DE SABAO', 3, 'AGUA');
INSERT INTO HAB_HABILIDADE (HAB_NOME, HAB_PODER_ATAQUE, TIP_NOME) VALUES ('CHAFARIZ DA PRAÇA', 80, 'AGUA');
INSERT INTO HAB_HABILIDADE (HAB_NOME, HAB_PODER_ATAQUE, TIP_NOME) VALUES ('TROVAO TROPICAL', 80, 'ELETRICO');
INSERT INTO HAB_HABILIDADE (HAB_NOME, HAB_PODER_ATAQUE, TIP_NOME) VALUES ('ESTATICA COM BEXIGA', 3, 'ELETRICO'); 

--INSERT 6 CRIATURAS, CADA UMA COM, NO MÍNIMO, 2 HABILIDADES. AO MENOS UMA DAS CRIATURAS DEVE TER DUAS HABILIDADES DIFERENTES DO TIPO FOGO
  --CRIATURAS
INSERT INTO CRI_CRIATURA (CRI_NOME, CRI_ATAQUE, CRI_ESTAMINA, CRI_DEFESA, CRI_ALTURA, CRI_PESO, CRI_CHANCE_CAPTURA) 
  VALUES ('SALAMANDRA CAOLHA', 30, 80, 40, 50, 7, 60);
INSERT INTO CRI_CRIATURA (CRI_NOME, CRI_ATAQUE, CRI_ESTAMINA, CRI_DEFESA, CRI_ALTURA, CRI_PESO, CRI_CHANCE_CAPTURA) 
  VALUES ('DRAGAO ASMATICO', 90, 30, 70, 750, 1520, 2);
INSERT INTO CRI_CRIATURA (CRI_NOME, CRI_ATAQUE, CRI_ESTAMINA, CRI_DEFESA, CRI_ALTURA, CRI_PESO, CRI_CHANCE_CAPTURA) 
  VALUES ('TUBARAO CEGO', 70, 70, 20, 700, 1100, 5);
INSERT INTO CRI_CRIATURA (CRI_NOME, CRI_ATAQUE, CRI_ESTAMINA, CRI_DEFESA, CRI_ALTURA, CRI_PESO, CRI_CHANCE_CAPTURA) 
  VALUES ('PIRANHA SEM DENTE', 5, 80, 35, 60, 1, 80);
INSERT INTO CRI_CRIATURA (CRI_NOME, CRI_ATAQUE, CRI_ESTAMINA, CRI_DEFESA, CRI_ALTURA, CRI_PESO, CRI_CHANCE_CAPTURA) 
  VALUES ('PORCO FOCINHO TOMADA', 25, 40, 60, 40, 80, 50);
INSERT INTO CRI_CRIATURA (CRI_NOME, CRI_ATAQUE, CRI_ESTAMINA, CRI_DEFESA, CRI_ALTURA, CRI_PESO, CRI_CHANCE_CAPTURA) 
  VALUES ('MACACO COM BEXIGA', 35, 80, 60, 80, 30, 50);
  
  --CRIATURA HABILIDADE
INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('SALAMANDRA CAOLHA', 'QUEIMAR COM FOSFORO');
INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('SALAMANDRA CAOLHA', 'METEORO DA PAIXAO');

INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('DRAGAO ASMATICO', 'QUEIMAR COM FOSFORO');
INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('DRAGAO ASMATICO', 'METEORO DA PAIXAO');

INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('TUBARAO CEGO', 'BOLINHA DE SABAO');
INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('TUBARAO CEGO', 'CHAFARIZ DA PRAÇA');

INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('PIRANHA SEM DENTE', 'BOLINHA DE SABAO');
INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('PIRANHA SEM DENTE', 'CHAFARIZ DA PRAÇA');

INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('PORCO FOCINHO TOMADA', 'TROVAO TROPICAL');
INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('PORCO FOCINHO TOMADA', 'ESTATICA COM BEXIGA');

INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('MACACO COM BEXIGA', 'TROVAO TROPICAL');
INSERT INTO CRH_CRIATURA_HABILIDADE (CRI_NOME, HAB_NOME) VALUES ('MACACO COM BEXIGA', 'ESTATICA COM BEXIGA');

--INSERT 6 LOCAIS, SENDO 3 PUBLICOS E 3 PRIVADOS. CADA LOCAL DEVE TER, NO MÍNIMO, DUAS CRIATURAS
  --LOCAIS
INSERT INTO LOC_LOCAL (LOC_LATITUDE, LOC_LONGITUDE, LOC_NOME, LOC_SEGURO) 
  VALUES (12.56, 13.469, 'CAVERNA DO DRAGAO', 'S');
INSERT INTO LOC_LOCAL (LOC_LATITUDE, LOC_LONGITUDE, LOC_NOME, LOC_SEGURO) 
  VALUES (65.48, 91.11, 'VULCAO SEM LAVA', 'N');
INSERT INTO LOC_LOCAL (LOC_LATITUDE, LOC_LONGITUDE, LOC_NOME, LOC_SEGURO) 
  VALUES (29.879, 35.716, 'PISCINA DO TEATRAO', 'N');
INSERT INTO LOC_LOCAL (LOC_LATITUDE, LOC_LONGITUDE, LOC_NOME, LOC_SEGURO) 
  VALUES (75.31, 95.11, 'PISCINA 7 MARES', 'S');
INSERT INTO LOC_LOCAL (LOC_LATITUDE, LOC_LONGITUDE, LOC_NOME, LOC_SEGURO) 
  VALUES (34.53, 65.43, 'SAFARI ZZZ', 'S');
INSERT INTO LOC_LOCAL (LOC_LATITUDE, LOC_LONGITUDE, LOC_NOME, LOC_SEGURO) 
  VALUES (98.775, 36.925, 'PICO PREGOS BRANCOS', 'N');

  --PRIVADOS
INSERT INTO PRI_PRIVADO (LOC_LATITUDE, LOC_LONGITUDE, PRI_TAXA_ACESSO, PRI_HORARIO_FUNCIONAMENTO)
  VALUES(29.879, 35.716, 10, '7H AS 17H');
INSERT INTO PRI_PRIVADO (LOC_LATITUDE, LOC_LONGITUDE, PRI_TAXA_ACESSO, PRI_HORARIO_FUNCIONAMENTO)
  VALUES(75.31, 95.11, 50, '15H AS 5H');
INSERT INTO PRI_PRIVADO (LOC_LATITUDE, LOC_LONGITUDE, PRI_TAXA_ACESSO, PRI_HORARIO_FUNCIONAMENTO)
  VALUES(34.53, 65.43, 50, '4H AS 22H');

  --PUBLICOS
INSERT INTO PUB_PUBLICO (LOC_LATITUDE, LOC_LONGITUDE) VALUES (12.56, 13.469);
INSERT INTO PUB_PUBLICO (LOC_LATITUDE, LOC_LONGITUDE) VALUES (65.48, 91.11);
INSERT INTO PUB_PUBLICO (LOC_LATITUDE, LOC_LONGITUDE) VALUES (98.775, 36.925);

  --CRIATURA LOCAL
    --PISCINA 7 MARES
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('PIRANHA SEM DENTE', 75.31, 95.11, 70);
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE)
  VALUES ('TUBARAO CEGO', 75.31, 95.11, 20);

    --CAVERNA DO DRAGAO
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('DRAGAO ASMATICO', 12.56, 13.469, 2);
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('SALAMANDRA CAOLHA', 12.56, 13.469, 37);

    --SAFARI ZZZ
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('PIRANHA SEM DENTE', 34.53, 65.43, 80);
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE)
  VALUES ('MACACO COM BEXIGA', 34.53, 65.43, 50);

    --VULCAO SEM LAVA
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('PIRANHA SEM DENTE', 65.48, 91.11, 80);
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('SALAMANDRA CAOLHA', 65.48, 91.11, 50);

    --PISCINA TEATRAO
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('PIRANHA SEM DENTE', 29.879, 35.716, 80);
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE) 
  VALUES ('TUBARAO CEGO', 29.879, 35.716, 8);

    --PICO PREGOS BRANCOS
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE)
  VALUES ('MACACO COM BEXIGA', 98.775, 36.925, 60); 
INSERT INTO CRL_CRIATURA_LOCAL (CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE, CRL_CHANCE)
  VALUES ('PORCO FOCINHO TOMADA', 98.775, 36.925, 50);  

--INSERT 6 REGISTROS DE CAPUTURA (UTILIZAR A SEQUENCIA PARA CADASTRAR)
	--PISCINA 7 MARES
INSERT INTO CAP_CAPTURA (CAP_ID, CAP_DT_HR, CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE)
  VALUES(CAP_SEQ.NEXTVAL, TO_DATE('2016-10-02 12:45:15', 'YYYY-MM-DD HH24:MI:SS'), 'PIRANHA SEM DENTE', 75.31, 95.11); 
	
	--CAVERNA DO DRAGAO
INSERT INTO CAP_CAPTURA (CAP_ID, CAP_DT_HR, CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE)
  VALUES(CAP_SEQ.NEXTVAL, TO_DATE('2016-10-09 22:45:15', 'YYYY-MM-DD HH24:MI:SS'), 'DRAGAO ASMATICO', 12.56, 13.469);

	--SAFARI ZZZ
INSERT INTO CAP_CAPTURA (CAP_ID, CAP_DT_HR, CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE)
  VALUES(CAP_SEQ.NEXTVAL, TO_DATE('2016-10-10 22:45:15', 'YYYY-MM-DD HH24:MI:SS'), 'PIRANHA SEM DENTE', 34.53, 65.43);
  
	--VULCAO SEM LAVA
INSERT INTO CAP_CAPTURA (CAP_ID, CAP_DT_HR, CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE)
  VALUES(CAP_SEQ.NEXTVAL, TO_DATE('2016-10-15 22:45:15', 'YYYY-MM-DD HH24:MI:SS'), 'SALAMANDRA CAOLHA', 65.48, 91.11);
	
	--PICO PREGOS BRANCOS
INSERT INTO CAP_CAPTURA (CAP_ID, CAP_DT_HR, CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE)
  VALUES(CAP_SEQ.NEXTVAL, TO_DATE('2016-10-23 22:45:15', 'YYYY-MM-DD HH24:MI:SS'), 'MACACO COM BEXIGA', 98.775, 36.952);

	--PISCINA TEATRAO
INSERT INTO CAP_CAPTURA (CAP_ID, CAP_DT_HR, CRI_NOME, LOC_LATITUDE, LOC_LONGITUDE)
  VALUES(CAP_SEQ.NEXTVAL, TO_DATE('2016-10-29 22:45:15', 'YYYY-MM-DD HH24:MI:SS'), 'PIRANHA SEM DENTE', 29.879, 35.716);

--ALTERAR O NOME DE UM TIPO EXCETO FOGO E ATUALIZAR AS HABILIDADES
INSERT INTO TIP_TIPO (TIP_NOME) VALUES ('NORMAL');
UPDATE HAB_HABILIDADE SET TIP_NOME = 'NORMAL' WHERE TIP_NOME = 'ELETRICO'; 
DELETE FROM TIP_TIPO WHERE TIP_NOME = 'ELETRICO';

--EXCLUIR UM LOCAL PRIVADO
DELETE FROM PRI_PRIVADO WHERE (LOC_LATITUDE, LOC_LONGITUDE) IN 
  (SELECT LOC_LATITUDE, LOC_LONGITUDE FROM LOC_LOCAL WHERE LOC_NOME = 'PISCINA DO TEATRAO');

DELETE FROM LOC_LOCAL WHERE LOC_NOME = 'PISCINA DO TEATRAO';

-----------------------------------------INSERTS PARA SER POSSIVEL OS SELECTS-----------------------------------------
--CRIATURA TIPO 
INSERT INTO CRT_CRIATURA_TIPO (CRI_NOME, TIP_NOME) VALUES ('SALAMANDRA CAOLHA', 'FOGO');
INSERT INTO CRT_CRIATURA_TIPO (CRI_NOME, TIP_NOME) VALUES ('DRAGAO ASMATICO', 'FOGO');

INSERT INTO CRT_CRIATURA_TIPO (CRI_NOME, TIP_NOME) VALUES ('PIRANHA SEM DENTE', 'AGUA');
INSERT INTO CRT_CRIATURA_TIPO (CRI_NOME, TIP_NOME) VALUES ('TUBARAO CEGO', 'AGUA');
---------------------------------------------------------------------------------------------------------------------------
  
--SELECT OS NOMES DAS CRIATURAS DO TIPO FOGO QUE NUNCA FORAM CAPTURADAS
SELECT CRI_NOME FROM CRT_CRIATURA_TIPO WHERE TIP_NOME = 'FOGO' AND CRI_NOME NOT IN (SELECT CRI_NOME FROM CAP_CAPTURA);

--SELECT OS TIPOS DAS CRIATURAS QUE POSSUEM CHANCE DE CAPTURA SUPERIOR A 50% EM LUGARES PUBLICOS
SELECT TIP_NOME FROM CRT_CRIATURA_TIPO JOIN 
  (SELECT CRL_CRIATURA_LOCAL.CRI_NOME AS CRL_NOME FROM CRL_CRIATURA_LOCAL JOIN 
    (SELECT LOC_LOCAL.LOC_LATITUDE AS LOC_LAT, LOC_LOCAL.LOC_LONGITUDE AS LOC_LONG FROM LOC_LOCAL JOIN PUB_PUBLICO 
        ON LOC_LOCAL.LOC_LATITUDE = PUB_PUBLICO.LOC_LATITUDE AND LOC_LOCAL.LOC_LONGITUDE = PUB_PUBLICO.LOC_LONGITUDE) 
    ON CRL_CRIATURA_LOCAL.LOC_LATITUDE = LOC_LAT AND CRL_CRIATURA_LOCAL.LOC_LONGITUDE = LOC_LONG WHERE CRL_CHANCE > 50)
  ON CRT_CRIATURA_TIPO.CRI_NOME = CRL_NOME;

--SELECT O NOME DAS HABILIDADES DA CRIATURA QUE FOI CAPTURADA POR ULTIMO
SELECT HAB_NOME FROM CRH_CRIATURA_HABILIDADE WHERE CRI_NOME = 
  (SELECT CRI_NOME FROM CAP_CAPTURA WHERE CAP_DT_HR = 
    (SELECT * FROM (SELECT CAP_DT_HR FROM CAP_CAPTURA ORDER BY CAP_DT_HR DESC) WHERE ROWNUM = 1));

--SELECT O NOME DAS CRIATURAS QUE SOMENTE APARECEM EM LUGARES PRIVADOS
SELECT CRI_NOME FROM CRL_CRIATURA_LOCAL JOIN 
  (SELECT LOC_LOCAL.LOC_LATITUDE AS LOC_LAT, LOC_LOCAL.LOC_LONGITUDE AS LOC_LONG FROM LOC_LOCAL 
    JOIN PRI_PRIVADO ON PRI_PRIVADO.LOC_LATITUDE = LOC_LOCAL.LOC_LATITUDE AND PRI_PRIVADO.LOC_LONGITUDE = LOC_LOCAL.LOC_LONGITUDE)
  ON CRL_CRIATURA_LOCAL.LOC_LATITUDE = LOC_LAT AND CRL_CRIATURA_LOCAL.LOC_LONGITUDE = LOC_LONG;

--SELECT O NOME DAS CRIATURAS CAPTURADAS QUE POSSUEM MAIS DE UMA HABILIDADE DO TIPO FOGO
SELECT CRI_NOME FROM CRH_CRIATURA_HABILIDADE 
  JOIN HAB_HABILIDADE ON HAB_HABILIDADE.HAB_NOME = CRH_CRIATURA_HABILIDADE.HAB_NOME 
    WHERE HAB_HABILIDADE.TIP_NOME = 'FOGO' 
      GROUP BY CRI_NOME HAVING COUNT(*) > 1;